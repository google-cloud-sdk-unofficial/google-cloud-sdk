# Copyright 2018 Google LLC. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

type:
  api_field: googleFirestoreAdminV1Database.type
  arg_name: type
  help_text: The database type.
  required: false
  choices:
  - arg_value: firestore-native
    enum_value: FIRESTORE_NATIVE
  - arg_value: datastore-mode
    enum_value: DATASTORE_MODE

query_scope:
  api_field: googleFirestoreAdminV1Index.queryScope
  arg_name: query-scope
  help_text: Query scope the index applies to.
  default: collection
  choices:
  - arg_value: collection
    enum_value: COLLECTION
  - arg_value: collection-group
    enum_value: COLLECTION_GROUP
  - arg_value: collection-recursive
    enum_value: COLLECTION_RECURSIVE

api_scope:
  api_field: googleFirestoreAdminV1Index.apiScope
  arg_name: api-scope
  help_text: Api scope the index applies to.
  default: any-api
  choices:
  - arg_value: any-api
    enum_value: ANY_API
  - arg_value: datastore-mode-api
    enum_value: DATASTORE_MODE_API

field_config:
  api_field: googleFirestoreAdminV1Index.fields
  arg_name: field-config
  help_text: |
    Configuration for a field.

    This flag must be repeated to provide the ordered list of field configurations comprising
    the composite index. For example:

      $ {command} \
          --collection-group=Events \
          --field-config field-path=tags,array-config=contains \
          --field-config field-path=user_id,order=descending \
          --field-config field-path=timestamp,order=descending

    The following keys are allowed:

    *field-path*::: Specifies the field path (e.g. 'address.city'). This is required.

    *order*::: Specifies the order. Valid options are: 'ascending', 'descending'. Exactly one of
    order or array-config must be specified.

    *array-config*::: Specifies the configuration for an array field. The only valid option is
    'contains'. Exactly one of 'order' or 'array-config' must be specified.

  type:
    arg_dict:
      flatten: false
      spec:
      - api_field: fieldPath
        arg_name: field-path
      - api_field: arrayConfig
        arg_name: array-config
        type: str
        required: false
        choices:
        - arg_value: contains
          enum_value: CONTAINS
      - api_field: order
        arg_name: order
        type: str
        required: false
        choices:
        - arg_value: ascending
          enum_value: ASCENDING
        - arg_value: descending
          enum_value: DESCENDING

index:
  api_field: googleFirestoreAdminV1Field.indexConfig.indexes
  arg_name: index
  metavar: KEY=VALUE
  processor: googlecloudsdk.command_lib.firestore.util:AddQueryScope
  help_text: |
    An index for the field.

    This flag can be repeated to provide multiple indexes. Any existing indexes will
    be overwritten with the ones provided. Any omitted indexes will be deleted if
    they currently exist.

    The following keys are allowed:

    *order*:::: Specifies the order. Valid options are: 'ascending', 'descending'.
    Exactly one of 'order' or 'array-config' must be specified.

    *array-config*:::: Specifies the configuration for an array field. The only
    valid option is 'contains'. Exactly one of 'order' or 'array-config' must be
    specified.

  type:
    arg_dict:
      flatten: false
      spec:
      - api_field: fields.arrayConfig
        arg_name: array-config
        type: str
        required: false
        choices:
        - arg_value: contains
          enum_value: CONTAINS
      - api_field: fields.order
        arg_name: order
        type: str
        required: false
        choices:
        - arg_value: ascending
          enum_value: ASCENDING
        - arg_value: descending
          enum_value: DESCENDING

disable_indexes:
  arg_name: disable-indexes
  help_text: If provided, the field will no longer be indexed at all.
  action: store_true

clear_exemption:
  arg_name: clear-exemption
  help_text: |
    If provided, the field's current index configuration will be
    reverted to inherit from its ancestor index configurations.
  action: store_true
