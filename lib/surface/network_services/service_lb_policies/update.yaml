release_tracks: [ALPHA]

help_text:
  brief: |
    Update a service LB policy.
  description: |
    Update the detail of a service LB Policy.
  examples: |
    Update load-balancing-algorithm of a service LB policy named ``my-service-lb-policy'':

      $ {command} my-service-lb-policy
        --load-balancing-algorithm="NEAREST_ZONE_FIRST"

arguments:
  resource:
    spec: !REF googlecloudsdk.command_lib.network_services.resources:serviceLbPolicy
    help_text: |
      Name of the service LB policy to be updated.
  params:
  - arg_name: load-balancing-algorithm
    api_field: serviceLbPolicy.loadBalancingAlgorithm
    help_text: |
      The global load balancing algorithm to be used.
    choices:
    - arg_value: balance-over-region
      enum_value: BALANCE_OVER_REGION
      help_text: |
        Direct traffic to the nearest region with endpoints and capacity before spilling over to
        other regions.
    - arg_value: nearest-zone-first
      enum_value: NEAREST_ZONE_FIRST
      help_text:  |
        Attempt to keep traffic in a single zone closest to the client, before spilling over to
        other zones.
    default: balance-over-region
  - arg_name: reduce-spike-overload
    api_field: serviceLbPolicy.reduceSpikeOverload
    help_text: |
      If specified, will spread the traffic from each client to all the MIGs/NEGs in a region.
      This option and behavior will be disabled if load-balancing-algorithm=NEAREST_ZONE_FIRST, as
      they are incompatible.
  - arg_name: auto-capacity-drain
    api_field: serviceLbPolicy.autoCapacityDrain
    ALPHA:
      processor: googlecloudsdk.command_lib.network_services.util:AutoCapacityDrainHook:api_version=v1alpha1
    help_text: |
      If specified, an unhealthy MIG/NEG will be removed from Global load balancing and traffic
      routing for the service.
      A MIG/NEG is considered to be unhealthy if less than 25% of the instance/endpoints in the
      MIG/NEG are healthy.
      autoCapacityDrain will never drain more than 50% of the configured MIGs/NEGs of a Backend
      Service.
    type: bool
  - arg_name: primary-backends
    api_field:  serviceLbPolicy.primaryBackends
    help_text: |
      A list of MIGs/NEGs fully-qualified by its resource identifier where the traffic should first
      be routed to and capacity filled before routing to other MIGs/NEGs of the backendService this
      serviceLbPolicy is associated with.
      The MIG/NEG must exist in the same project. In order for them to receive traffic, it must also
      be referenced by the backendService which references this serviceLbPolicy.
    type: arg_list
  - arg_name: description
    api_field: serviceLbPolicy.description
    help_text: The description for the service LB policy.

async:
  collection: networkservices.projects.locations.operations

request:
  api_version: v1alpha1
  collection: networkservices.projects.locations.serviceLbPolicies
  method: patch
